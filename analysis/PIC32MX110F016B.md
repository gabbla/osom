# **PIC32MX110F016B**

Due to the very un-user friendly TI's SDK for CC2541 (based on IAR only), I decided to change the architecture on board: master ans slave will still have the same HW, where the second will have less components mounted on it.

## Architecture
The new architecture is the following:

Clinet <==BLE==> Master <==2.4GHz==> Slave

where:
- Master: CC2541 <==UART==> PIC <==SPI==> nRF24L01+
- Slave:  PIC <==SPI==> nRF24L01+

The client is a device with a custom application installed on it. It must be compatible with BLE (Bluetooth 4.x).

The CC2541 (aka NP, aka Network Processor) will run a standard firmware that is in charge of providing a virtual serial port to the PIC.

Master and Slave will exchange messages on a custom protocol, based on **Message Pack**.

## PIC's PIN assignment

### Bluetooth (master only)

PIN|I/O|PPS|Function|Note
--|--
6|IN|RPB2|U1RX|PIC <== BLE
7|OUT|RPB3|U1TX|PIC ==> BLE

### nRF24L01+

PIN|I/O|PPS|Function|Note
--|--
21|IN|RPB10|INT1|Interrupt generated by nRF24L01+
22|OUT|RPB11|SDO2|
23|OUT|-|CS|RB12
24|IN|RPB13|SDI2|
25|OUT|-|CE|RB14
26|OUT|RPB15|SCK2|

### Sensing

PIN|I/O|PPS|Function|Note
--|--
16|IN|-|INT0|Left IN Interrupt
11|IN|RPB4|INT4|Right IN Interrupt
2|OUT|-|Left Laser Ctl|RA0
3|OUT|-|Right Laser Ctl|RA1

### Battery Charger

TBD in I/O Expander

### I/O Expander I2C

PIN|I/O|PPS|Function|Note
--|--
17|OUT|-|SCL|
18|I/O|-|SDA|

**Note**: Only output are available on I/O Expander, that's because we don't have to monitor the Interrupt from it.

BIT|Function
--|--
0|LED Power
1|Left status
2|Right status
6|EN1
7|EN2

### LEDs

TBD in I/O Expander


**Note**
1. Master only: an extra LED from CC2541 indicates the BT connection status.
2. From the battery charger 2 extra LEDs will indicate the status of the battery and charging state.

## Features to be evaluated

- [ ] Power button
- [ ] Battery level
- [ ] Battery status
- [ ] Debug UART

## Other stuff

- Keep the HM10 (CC2541 breakout) debug connector
  - Change the pin header with an IDC socket
