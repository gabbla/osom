# **Speedometer** **WIP**

Due to the very un-user friendly TI's SDK for CC2541 (based on IAR only), I decided to change the architecture on board: master and slave will still share the same HW, while the second will have less components mounted on it.

## Architecture
The new architecture is the following:

Clinet <==BLE==> Master <==2.4GHz==> Slave

where:
- Master: CC2541 <==UART==> PIC <==SPI==> nRF24L01+
- Slave:  PIC <==SPI==> nRF24L01+

The client is a device with a custom application installed on it. It must be compatible with BLE (Bluetooth 4.x).

The CC2541 (aka NP, aka Network Processor) will run a standard firmware that is in charge of providing a virtual serial port to the PIC.

Master and Slave will exchange messages over a custom light-weight protocol.

## Specifications

- Microcontroller: PIC32MX274F256D @72MHz (TODO verify)
- Bluetooth (master only): HM10 Bluetooth 4.2 Low Energy
- Power: 
	- LiPo 1s Battery, 1200/2000 mAh (not choosen yet)
	- 5V provided by micro USB, 500 mA MAX
- Sensor: custom made 650nm modulated laser sensor 
- Laser source: Red diode laser, 650nm @5mW

## PIC PIN assignment

### Bluetooth (master only)

PIN|I/O|PPS|Function|Note
--|--|--|--|--|
6|IN|RPB2|U1RX|PIC <== NP
7|OUT|RPB3|U1TX|PIC ==> NP

### nRF24L01+

PIN|I/O|PPS|Function|Note
--|--|--|--|--|
21|IN|RPB10|INT1|Interrupt generated by nRF24L01+
22|OUT|RPB11|SDO2|
23|OUT|-|CS|RB12
24|IN|RPB13|SDI2|
25|OUT|-|CE|RB14
26|OUT|RPB15|SCK2|

### Debug

PIN|I/O|PPS|Function|Note
--|--|--|--|--|
4|OUT|RPB0|U2TX|PIC ==> PC
5|IN|RPB1|U2RX|PIC <== PC

USB will be available too, with at least a _comunication device class_ (CDC) enumeration. 

### Sensing

PIN|I/O|PPS|Function|Note
--|--|--|--|--|
16|IN|-|INT0|Left IN Interrupt
11|IN|RPB4|INT4|Right IN Interrupt

### Battery Charger

New PIC analisys required

### LEDs

Analisys required. 

**Note**
1. Master only: an extra LED from CC2541 indicates the BT connection status.
2. From the battery charger an extra LED indicates che charging status.
